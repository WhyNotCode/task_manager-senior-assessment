<p style="color: green"><%= notice %></p>
<h1>Tasks</h1>


<!-- Bootstrap alerts messages (this is code from the Bootstrap website)-->
<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill me-2"></i>
    <%= flash[:notice] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>

<% if flash[:alert] %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <%= flash[:alert] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>


<!-- Loading spinner JavaScript -->
<script>
  document.addEventListener('submit', function(event) {
    if (event.target.closest('form[action*="/tasks"]')) {
      document.getElementById('tasks-loading').classList.remove('d-none');
    }
  });

  // Handle Turbo method links (like the toggle complete links)
  document.addEventListener('click', function(event) {
    const link = event.target.closest('a[data-turbo-method]');
    if (link && link.href.includes('/tasks/')) {
      document.getElementById('tasks-loading').classList.remove('d-none');
    }
  });

  // Hide spinner when page loads
  document.addEventListener('turbo:load', function() {
    document.getElementById('tasks-loading').classList.add('d-none');
  });
</script>




<!-- Show high level statistics of all the tasks -->
<%= render 'stats' %>



<!-- New Task Button -->
<div class="mt-3 mt-md-4 text-center mb-3">
  <%= link_to "Create New Task", new_task_path, class: "btn btn-primary btn-lg w-30 w-md-auto" %>
</div>


<!-- Tasks columns - stack on mobile -->
<div class="row mb-5 flex-column flex-md-row">
  <!-- Incomplete Tasks Column -->
  <div class="col-12 col-md-6 mb-4 mb-md-0">
    <div class="card h-100">
      <div class="card-header bg-info text-white justify-content-between align-items-center d-flex">
        <h3 class="card-title h5 mb-0">Incomplete Tasks</h3>
        <h3>(<%= @incomplete_tasks.count %>)</h3>
      </div>
      <div class="card-body">
        <div id="incomplete-tasks">
          <% if @incomplete_tasks.any? %>
            <% @incomplete_tasks.each do |task| %>
              <%= render task %>
            <% end %>
          <% else %>
            <p class="text-muted text-center py-4">No incomplete tasks!</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Completed Tasks Column -->
  <div class="col-12 col-md-6">
    <div class="card h-100">
      <div class="card-header bg-success text-white justify-content-between align-items-center d-flex">
        <h3 class="card-title h5 mb-0">Completed Tasks</h3>
        <h3>(<%= @completed_tasks.count %>)</h3>
      </div>
      <div class="card-body">
        <div id="completed-tasks">
          <% if @completed_tasks.any? %>
            <% @completed_tasks.each do |task| %>
              <%= render task %>
            <% end %>
          <% else %>
            <p class="text-muted text-center py-4">No completed tasks yet. Get to work!</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


