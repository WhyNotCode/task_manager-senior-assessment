<p style="color: green"><%= notice %></p>
<h1>Tasks</h1>


<!-- Bootstrap alerts messages (this is code from the Bootstrap website)-->
<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill me-2"></i>
    <%= flash[:notice] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>

<% if flash[:alert] %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <%= flash[:alert] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>



<!-- Show high level statistics of all the tasks -->
<%= render 'stats' %>


<!-- Loading spinner overlay (similar to weather) -->
<div id="tasks-loading" class="position-fixed top-0 start-0 w-100 h-100 d-none" style="background: rgba(255,255,255,0.8); z-index: 1050;">
  <div class="position-absolute top-50 start-50 translate-middle text-center">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Processing...</p>
  </div>
</div>


<!-- Loading spinner JavaScript -->
<script>
  document.addEventListener('submit', function(event) {
    if (event.target.closest('form[action*="/tasks"]')) {
      document.getElementById('tasks-loading').classList.remove('d-none');
    }
  });

  // Handle Turbo method links (like the toggle complete links)
  document.addEventListener('click', function(event) {
    const link = event.target.closest('a[data-turbo-method]');
    if (link && link.href.includes('/tasks/')) {
      document.getElementById('tasks-loading').classList.remove('d-none');
    }
  });

  // Hide spinner when page loads
  document.addEventListener('turbo:load', function() {
    document.getElementById('tasks-loading').classList.add('d-none');
  });
</script>



<!-- New Task Button -->
<div class="mt-4 text-center mb-4">
  <%= link_to "Create New Task", new_task_path, class: "btn btn-primary btn-lg" %>
</div>


<div class="row mb-5">
  <!-- Incomplete Tasks Column -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0">Incomplete Tasks </h3>
        <h3> (<span id="incomplete-count"><%= @incomplete_tasks.count %></span>) </h3>
      </div>
      <div class="card-body">
        <div id="incomplete-tasks">
          <% if @incomplete_tasks.any? %>
            <% @incomplete_tasks.each do |task| %>
              <%= render task %>
            <% end %>
          <% else %>
            <p class="text-muted text-center py-4">No incomplete tasks!</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Completed Tasks Column -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0">Completed Tasks </h3>
        <h3>(<span id="completed-count"><%= @completed_tasks.count %></span>)</h3>
      </div>
      <div class="card-body">
        <div id="completed-tasks">
          <% if @completed_tasks.any? %>
            <% @completed_tasks.each do |task| %>
              <%= render task %>
            <% end %>
          <% else %>
            <p class="text-muted text-center py-4">No completed tasks yet. Get cracking...!</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


